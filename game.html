<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‹¯æ•‘å¤§é¹½æ¹–éŠæˆ²</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Noto Sans TC', sans-serif;
  background-color: #f0f8ff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.game-container {
  text-align: center;
  border: 2px solid #ddd;
  padding: 20px;
  background-color: #fff;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  width: 350px;
}

h1 {
  font-size: 24px;
  color: #333;
  margin-bottom: 20px;
}

/* æ¹–çš„èƒŒæ™¯å°‡æ”¹ç”¨ä¸‰å¼µåœ–ç‰‡åˆ‡æ› */
.lake {
  width: 100%;
  height: 200px;
  background-size: cover;
  background-position: center;
  border: 2px solid #00bfff;
  margin-bottom: 20px;
  border-radius: 5px;
  position: relative;
}

/* æ°´ä½è¦–è¦ºå·²ä¸å†ä½¿ç”¨ï¼Œä½†ä¿ç•™ç¯€çœæ”¹å‹• */
.water {
  display: none;
}

.floating-text {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  color: #0077ff;
  font-weight: bold;
  opacity: 0;
  animation: floatUp 0.5s ease-out forwards;
}

@keyframes floatUp {
  0% { opacity: 1; bottom: 10px; }
  100% { opacity: 0; bottom: 40px; }
}

.controls p {
  font-size: 18px;
  margin: 10px 0;
}

#click-button {
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  background-color: #00bfff;
  border: none;
  border-radius: 5px;
  color: white;
}

#click-button:active {
  background-color: #0099cc;
}

/* å½ˆçª— */
#knowledge-modal, #correct-modal, #wrong-modal, #upgrade-modal, #question-modal, #ready-modal, #end-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: white;
  padding: 20px;
  border-radius: 10px;
  width: 320px;
  text-align: center;
}

.upgrade-option, .answer-option, #restart-button {
  margin: 8px 0;
  padding: 8px;
  background-color: #00bfff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  width: 90%;
}

.upgrade-option:hover, .answer-option:hover, #restart-button:hover {
  background-color: #0099cc;
}
</style>
</head>
<body>
  <div class="game-container">
    <h1>æ‹¯æ•‘ä¹¾æ¶¸çš„å¤§é¹½æ¹–</h1>
    <div class="lake" id="lake"></div>

    <div class="controls">
      <p>æ°´é‡: <span id="water-level">0%</span></p>
      <p>å‰©é¤˜æ™‚é–“: <span id="timer">45</span>ç§’</p>
      <button id="click-button">é»æ“Šæ‹¯æ•‘!</button>
    </div>
  </div>

  <div id="upgrade-modal">
    <div class="modal-content" id="modal-content">
      <p id="modal-message"></p>
      <div id="upgrade-options"></div>
    </div>
  </div>

  <div id="question-modal">
    <div class="modal-content" id="question-content">
      <p id="question-text"></p>
      <div id="answer-options"></div>
    </div>
  </div>

  <div id="ready-modal">
    <div class="modal-content"><p>æº–å‚™ç­”é¡Œ...</p></div>
  </div>

  <div id="correct-modal" style="display:none;">
  <div class="modal-content">
    <p>ç­”å°äº†ï¼ŒçœŸå²å®³!</p>
  </div>
</div>

<div id="wrong-modal" style="display:none;">
  <div class="modal-content">
    <p>ç­”éŒ¯äº†ï¼Œå†åŠ æ²¹!</p>
  </div>
</div>

<div id="knowledge-modal" style="display:none;">
  <div class="modal-content">
    <p id="knowledge-text"></p>
    <button id="knowledge-confirm" class="upgrade-option">ç¢ºå®š</button>
  </div>
</div>

  <div id="end-screen">
    <div class="modal-content">
      <h2 id="end-title">éŠæˆ²çµæŸï¼</h2>
      <p id="final-score"></p>
      <p id="end-message"></p>
      <button id="restart-button">é‡æ–°é–‹å§‹</button>
    </div>
  </div>

<script>
let waterLevel = 0;
let timeLeft = 45;
let clickPower = 0.2;
let autoFillActive = false;
let autoFillRate = 1000;
let autoFillChance = 0;
let autoFillMultiplier = 2;
let autoFillTimer = null;
let firstCorrect = false;
let gameEnded = false;

const lake = document.getElementById("lake");
const waterLevelDisplay = document.getElementById("water-level");
const timerDisplay = document.getElementById("timer");
const clickButton = document.getElementById("click-button");

const modal = document.getElementById("upgrade-modal");
const modalMessage = document.getElementById("modal-message");
const upgradeOptions = document.getElementById("upgrade-options");

const questionModal = document.getElementById("question-modal");
const questionText = document.getElementById("question-text");
const answerOptions = document.getElementById("answer-options");

const readyModal = document.getElementById("ready-modal");
const endScreen = document.getElementById("end-screen");
const finalScore = document.getElementById("final-score");
const endTitle = document.getElementById("end-title");
const endMessage = document.getElementById("end-message");

let upgradeCounts = { option1: 0, option2: 0, option3: 0, option4: 0 };

/* === é¡Œåº« === */
const firstQuestion = {
  time: 40,
  text: "è«‹å•ä»¥ä¸‹å“ªå€‹è§’è‰²çš„æƒ³æ³•æˆ–æ…‹åº¦æœ€æœ‰åŠ©æ–¼æ¸›ç·©å¤§é¹½æ¹–çš„ç¼ºæ°´å±æ©Ÿï¼Ÿ",
  options: [
    "è¾²å¤«:é‡åˆ°è±æ°´å¹´æ™‚ï¼Œèªç‚ºè‡ªå·±å¾ˆå¹¸é‹ï¼Œä¸éœ€è¦å†ç¯€ç´„ç”¨æ°´",
    "é’å¹´:å¤§é¹½æ¹–ç¼ºæ°´æ˜¯ä¸Šä¸€ä»£æƒ¹çš„ç¦ï¼Œä»–å€‘è‡ªè¡Œè§£æ±ºå°±å¥½",
    "å·æ”¿åºœ:ç¶­æŒèˆŠæœ‰æ³•å¾‹ï¼Œç¯€çœä¸‹ä¾†çš„æ°´ä¸é ˆå›æµå¤§é¹½æ¹–",
    "ç‰§å ´ä¸»:å’Œå·æ”¿åºœé…åˆï¼ŒæŠ•è³‡æ–°æŠ€è¡“ä»¥ä½¿ç”¨æ›´å°‘çš„æ°´ç¨®æ¤è¾²ä½œç‰©"
  ],
  correct: 3
};

const otherQuestions = [
  {
    time: 35,
    text: "ä»¥ä¸‹ä½•è€…å’Œå¤§é¹½æ¹–ç¾ä»Šé¢è‡¨çš„å±æ©Ÿè¼ƒç„¡é—œä¿‚ï¼Ÿ",
    options: [
      "å› å…¨çƒæš–åŒ–ï¼Œèå†°å¢åŠ é€ æˆæ°´ä½ä¸Šå‡ä¸”ç ´å£å¤©ç„¶æ»‘é›ªå ´",
      "é¹½åº¦ä¸Šå‡ï¼Œè‡´ä½¿å¤šç¨®å¾®ç”Ÿç‰©ã€è±å¹´è¦ç­‰éƒ½é›£ä»¥ç”Ÿå­˜",
      "æ¹–åºŠä¹¾æ¶¸å°è‡´æ›´å¤šæœ‰æ¯’æ²™å¡µé£›æš",
      "æ°´ä½ä¸‹é™ä½¿å­¤å³¶å’Œå¤§é™¸ç›¸é€£ï¼Œæ•é£Ÿé³¥é¡çš„æ é£Ÿè€…å¾—ä»¥é€²å…¥"
    ],
    correct: 0
  },
  {
    time: 25,
    text: "ä»¥ä¸‹ä½•è€…åœ¨å¤§é¹½æ¹–ç”Ÿæ…‹ç³»ä¸­ä¸¦éæ‰®æ¼”ä¸»è¦è§’è‰²ï¼Ÿ",
    options: ["æµ®æ¸¸æ¤ç‰©", "è±å¹´è¦", "é­šé¡", "å€™é³¥"],
    correct: 2
  },
  {
    time: 20,
    text: "ä»¥ä¸‹æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ",
    options: [
      "å¤§é¹½æ¹–çš„æ¹–æ°´å¯†åº¦ä¹‹é«˜ï¼Œä½¿äººå€‘å¯ä»¥è¼•æ˜“æµ®åœ¨æ°´ä¸Š",
      "æ•¸é‡é©šäººçš„é¹½æ°´è’¼è …æˆç‚ºå€™é³¥è±å¯Œçš„é£Ÿç‰©ä¾†æº",
      "ä¸åŒæ£µç™½æ¥Šæ¨¹é–“å› èƒ½å…±äº«æ°´è³‡æºï¼Œä½¿æ¨¹ç¾¤æˆç‚ºåœ°çƒä¸Šæœ€å¤§ç”Ÿç‰©é«”ä¹‹ä¸€",
      "å–‡å­å¤©éµæ›¾ä¸€åº¦ç€•è‡¨æ»…çµ•ï¼Œå¦‚ä»Šæœ‰æ•¸è¬éš»ï¼Œæ˜¯å¾©è‚²æˆåŠŸçš„æ¡ˆä¾‹",
      "ä»¥ä¸Šçš†æ˜¯"
    ],
    correct: 4
  },
  {
    time: 10,
    text: "ä»¥ä¸‹ä½•è€…æ¶ˆè€—äº†æœ€å¤šå¤§é¹½æ¹–ä¸Šæ¸¸çš„æ°´ï¼Ÿ",
    options: ["å®¶åº­ç”¨æ°´", "è¾²æ¥­", "æ¤ç‰©è’¸æ•£ä½œç”¨", "å·¥æ¥­"],
    correct: 1
  }
];

/* === çŸ¥è­˜è¦–çª—å…§å®¹ === */
const knowledgeTexts = {
  "è«‹å•ä»¥ä¸‹å“ªå€‹è§’è‰²çš„æƒ³æ³•æˆ–æ…‹åº¦æœ€æœ‰åŠ©æ–¼æ¸›ç·©å¤§é¹½æ¹–çš„ç¼ºæ°´å±æ©Ÿï¼Ÿ":
    "è¾²å¤«åœ¨è±æ°´å¹´ä»é ˆæœªé›¨ç¶¢ç¹†ç¯€ç´„ç”¨æ°´ã€‚<br><br>å¤§é¹½æ¹–çš„å‘½é‹å’Œé’å¹´çš„æœªä¾†æ¯æ¯ç›¸é—œï¼Œå› æ­¤ä»–å€‘æ‡‰ç©æ¥µåƒèˆ‡ä¿è­·å®ƒçš„è¡Œå‹•ã€‚<br><br>å·æ”¿åºœä¿®æ”¹æ³•å¾‹æœ‰åŠ©ä½¿ç¯€çœä¸‹ä¾†çš„æ°´å›æµå¤§é¹½æ¹–ã€‚",

  "ä»¥ä¸‹ä½•è€…å’Œå¤§é¹½æ¹–ç¾ä»Šé¢è‡¨çš„å±æ©Ÿè¼ƒç„¡é—œä¿‚ï¼Ÿ":
    "å¤§é¹½æ¹–ç¾ä»Šçš„ä¸»è¦å±æ©Ÿç‚ºæ°´ä½ä¸è¶³ï¼Œæ­¤ç¾è±¡å°è‡´å­¤å³¶å’Œå¤§é™¸ç›¸é€£ï¼Œä½¿æ•é£Ÿé³¥é¡çš„æ é£Ÿè€…å¾—ä»¥é€²å…¥å­¤å³¶ã€‚<br><br>å¦å¤–ï¼Œç¸½æ°´é‡ä¸‹é™ä½¿é¹½åº¦ä¸Šå‡ï¼Œç”Ÿç‰©å› æ­¤æ›´åŠ é›£ä»¥ç”Ÿå­˜ã€‚<br><br>ä¹¾æ¶¸çš„æ¹–åºŠä¹Ÿè®“æ›´å¤šæœ‰æ¯’æ²™å¡µè¢«é¢¨å¹èµ·ã€‚",

  "ä»¥ä¸‹ä½•è€…åœ¨å¤§é¹½æ¹–ç”Ÿæ…‹ç³»ä¸­ä¸¦éæ‰®æ¼”ä¸»è¦è§’è‰²ï¼Ÿ":
    "æµ®æ¸¸æ¤ç‰©ã€è±å¹´è¦ã€å€™é³¥çš†æ˜¯å¤§é¹½æ¹–ç”Ÿæ…‹ç³»çš„ä¸€ä»½å­ï¼Œä½†æ¹–æ°´é¹½åº¦å¤ªé«˜ï¼Œé­šé¡ç„¡æ³•ç”Ÿå­˜ã€‚",

  "ä»¥ä¸‹ä½•è€…æ¶ˆè€—äº†æœ€å¤šå¤§é¹½æ¹–ä¸Šæ¸¸çš„æ°´ï¼Ÿ":
    "è¾²æ¥­ç”¨æ°´å å¤§é¹½æ¹–ä¸Šæ¸¸ä¹‹å¼•ç”¨æ°´çš„60%ä»¥ä¸Šã€‚"
};

// æ’åºé¡Œç›®
const shuffled = otherQuestions.sort(() => Math.random() - 0.5);
const questionSchedule = [
  firstQuestion,
  { ...shuffled[0], time: 35 },
  { ...shuffled[1], time: 25 },
  { ...shuffled[2], time: 20 },
  { ...shuffled[3], time: 10 }
];

/*===============
  â­ åˆ‡æ›èƒŒæ™¯åœ–ç‰‡
===============*/
function updateLakeImage() {
  if (waterLevel < 33) {
    lake.style.backgroundImage =
     "url('https://raw.githubusercontent.com/tam004team/Great_salt_lake/main/images/Salt_lake(gif)-46.png')";
  } else if (waterLevel < 67) {
    lake.style.backgroundImage =
     "url('https://raw.githubusercontent.com/tam004team/Great_salt_lake/main/images/Salt_lake(gif)-23.png')";
  } else {
    lake.style.backgroundImage =
     "url('https://raw.githubusercontent.com/tam004team/Great_salt_lake/main/images/Salt_lake(gif)-0.png')";
  }
}

/* èˆŠ visual æ•ˆæœå…¨å–æ¶ˆï¼Œåªæ›´æ–°æ•¸å­— & åœ–ç‰‡ */
function updateWaterLevel() {
  if (waterLevel > 100) waterLevel = 100;
  waterLevelDisplay.textContent = `${parseFloat(waterLevel.toFixed(2))}%`;
  updateLakeImage();

  if (!gameEnded && waterLevel >= 100) endGame(true);
}

function showFloatingText(amount) {
  const text = document.createElement("div");
  text.className = "floating-text";
  text.textContent = `+${parseFloat(amount.toFixed(2))}%`;
  lake.appendChild(text);
  setTimeout(() => text.remove(), 500);
}

/* è‡ªå‹•æ³¨æ°´ */
function startAutoFill() {
  if (autoFillTimer) clearInterval(autoFillTimer);
  autoFillActive = true;
  autoFillTimer = setInterval(() => {
    let addAmount = 1;
    if (Math.random() < autoFillChance) addAmount = autoFillMultiplier;
    waterLevel += addAmount;
    updateWaterLevel();
    showFloatingText(addAmount);
  }, autoFillRate);
}

/* è¨ˆæ™‚æš«åœ / æ¢å¾© */
function pauseTimer() {
  clearInterval(timerInterval);
  if (autoFillTimer) clearInterval(autoFillTimer);
}

function resumeTimer() {
  startTimer();
  if (autoFillActive) startAutoFill();
}

function showReadyMessage(nextAction) {
  pauseTimer();
  readyModal.style.display = "flex";
  setTimeout(() => {
    readyModal.style.display = "none";
    nextAction();
  }, 2000);
}

/* é¡Œç›® */
function showQuestion(q) {
  pauseTimer();
  questionModal.style.display = "flex";
  questionText.textContent = q.text;
  answerOptions.innerHTML = "";
  q.options.forEach((opt, i) => {
    const btn = document.createElement("button");
    btn.className = "answer-option";
    btn.textContent = opt;
    btn.onclick = () => handleAnswer(q, i);
    answerOptions.appendChild(btn);
  });
}

function handleAnswer(q, i) {
  questionModal.style.display = "none";
  pauseTimer();

  const correctModal = document.getElementById("correct-modal");
  const wrongModal = document.getElementById("wrong-modal");
  const knowledgeModal = document.getElementById("knowledge-modal");
  const knowledgeText = document.getElementById("knowledge-text");
  const knowledgeConfirm = document.getElementById("knowledge-confirm");

  const hasKnowledge = knowledgeTexts[q.text] !== undefined;

  // è™•ç†çŸ¥è­˜è¦–çª—å¾Œçš„å‹•ä½œï¼ˆç­”å°æµç¨‹ or ç­”éŒ¯æµç¨‹ï¼‰
  function continueAfterKnowledge() {
    // â­ ç­”å°
    if (i === q.correct) {
      // ç¬¬ä¸€é¡Œï¼šçµ¦æ–°æ©Ÿå™¨
      if (!firstCorrect) {
        firstCorrect = true;
        modal.style.display = "flex";
        modalMessage.textContent = "ç²å¾—æ–°æ©Ÿå™¨ï¼Œå¯è‡ªå‹•æ³¨æ°´ï¼";
        upgradeOptions.innerHTML = "";
        setTimeout(() => {
          modal.style.display = "none";
          startAutoFill();
          resumeTimer();
        }, 1000);
      } else {
        // å…¶ä»–é¡Œï¼šå‡ç´šé¸å–®
        showUpgradeMenu();
      }
    }
    else {
      // â­ ç­”éŒ¯ â†’ ç¹¼çºŒéŠæˆ²
      resumeTimer();
    }
  }

  // =======================
  // â­ å…ˆé¡¯ç¤ºç­”å° / ç­”éŒ¯
  // =======================
  if (i === q.correct) {
    correctModal.style.display = "flex";
    setTimeout(() => {
      correctModal.style.display = "none";

      // â­ è‹¥æœ‰çŸ¥è­˜ â†’ é¡¯ç¤ºçŸ¥è­˜è¦–çª—
      if (hasKnowledge) {
        knowledgeText.innerHTML = knowledgeTexts[q.text];
        knowledgeModal.style.display = "flex";

        knowledgeConfirm.onclick = () => {
          knowledgeModal.style.display = "none";
          continueAfterKnowledge();
        };
      } else {
        continueAfterKnowledge();
      }

    }, 1000);
  }
  else {
    wrongModal.style.display = "flex";
    setTimeout(() => {
      wrongModal.style.display = "none";

      if (hasKnowledge) {
        knowledgeText.innerHTML = knowledgeTexts[q.text];
        knowledgeModal.style.display = "flex";

        knowledgeConfirm.onclick = () => {
          knowledgeModal.style.display = "none";
          continueAfterKnowledge();
        };

      } else {
        continueAfterKnowledge();
      }
    }, 1000);
  }
}

/* å‡ç´šé¸å–® */
function showUpgradeMenu() {
  pauseTimer();
  modal.style.display = "flex";
  modalMessage.textContent = "é¸æ“‡ä¸€é …å‡ç´š";
  upgradeOptions.innerHTML = "";

  if (upgradeCounts.option1 < 2) addUpgradeOption("æ¯æ¬¡é»æ“Šæ³¨æ°´é‡ä¸Šå‡0.05%", "option1");
  if (upgradeCounts.option2 < 2) addUpgradeOption("è‡ªå‹•æ³¨æ°´æ™‚é–“é–“éš”ç¸®çŸ­20%", "option2");
  if (upgradeCounts.option3 < 2) addUpgradeOption("è‡ªå‹•æ³¨æ°´é‡åŠ å€ä¹‹æ©Ÿç‡ä¸Šå‡25%", "option3");
  if (upgradeCounts.option3 > 0 && upgradeCounts.option4 < 1) addUpgradeOption("æ¯æ¬¡è‡ªå‹•æ³¨æ°´é‡åŠ å€æ™‚ï¼Œå€ç‡ä¸Šå‡è‡³3å€", "option4");
}

function addUpgradeOption(text, key) {
  const btn = document.createElement("button");
  btn.className = "upgrade-option";
  btn.textContent = text;
  btn.onclick = () => selectUpgrade(key);
  upgradeOptions.appendChild(btn);
}

function selectUpgrade(key) {
  upgradeCounts[key]++;

  if (key === "option1") clickPower = clickPower < 0.25 ? 0.25 : 0.3;
  else if (key === "option2") {
    autoFillRate = autoFillRate === 1000 ? 800 : 640;
    if (autoFillActive) startAutoFill();
  }
  else if (key === "option3") autoFillChance = autoFillChance === 0 ? 0.25 : 0.5;
  else if (key === "option4") autoFillMultiplier = 3;

  modal.style.display = "none";
  resumeTimer();
}

/* è¨ˆæ™‚å™¨ */
let timerInterval;
function startTimer() {
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = timeLeft;

    const q = questionSchedule.find(q => q.time === timeLeft);
    if (q) showReadyMessage(() => showQuestion(q));

    if (timeLeft <= 0) endGame();
  }, 1000);
}

/* çµæŸç•«é¢ */
function endGame(isEarlyWin = false) {
  if (gameEnded) return;
  gameEnded = true;

  clearInterval(timerInterval);
  if (autoFillTimer) clearInterval(autoFillTimer);
  clickButton.disabled = true;

  endScreen.style.display = "flex";
  finalScore.textContent = `ä½ çš„æœ€çµ‚æ°´ä½æ˜¯ ${parseFloat(waterLevel.toFixed(2))}%`;

  if (isEarlyWin || waterLevel >= 67) {
    endTitle.textContent = "ğŸ‰ æ­å–œéé—œï¼";
    endMessage.textContent = "æ­å–œ!å¤§é¹½æ¹–æ°´ä½å·²æ¢å¾©æ­£å¸¸ï¼Œè¬è¬ä½ çš„åŠªåŠ›!";
  } else {
    endTitle.textContent = "ğŸ˜¢ æŒ‘æˆ°å¤±æ•—";
    endMessage.textContent = "å¥½å¯æƒœ!å¤§é¹½æ¹–æ°´ä½ä»ä¸è¶³ï¼Œå†æ¥å†å²!";
  }
}

document.getElementById("restart-button").onclick = () => {
  location.href = "index.html";
};

/* é»æ“Šæ³¨æ°´ */
clickButton.addEventListener("click", () => {
  if (waterLevel < 100 && !gameEnded) {
    waterLevel += clickPower;
    updateWaterLevel();
    showFloatingText(clickPower);
  }
});

/* é–‹å±€è¨­å®š */
updateLakeImage();
updateWaterLevel();
startTimer();
</script>
</body>
</html>
